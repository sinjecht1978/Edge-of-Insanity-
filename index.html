<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cards Game - Mobile Friendly</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            padding: 15px;
        }
        
        .screen {
            display: none;
        }
        
        .screen.active {
            display: block;
        }
        
        .header {
            text-align: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            margin: 5px;
            text-align: center;
            display: inline-block;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ffb347 0%, #ffcc33 100%);
            color: #333;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 12px;
            margin: 8px 0;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .card:hover {
            transform: translateY(-3px);
            border-color: #667eea;
        }
        
        .card.selected {
            border-color: #4CAF50;
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
        }
        
        .card.disabled {
            opacity: 0.5;
            background: #f5f5f5;
            cursor: not-allowed;
        }
        
        .card.disabled:hover {
            transform: none;
            border-color: #e0e0e0;
        }
        
        .card.black {
            background: #333;
            color: white;
            border-color: #222;
            padding: 15px;
            font-size: 18px;
            text-align: center;
            margin: 15px 0;
            cursor: default;
        }
        
        .hand-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 10px;
            margin: 15px 0;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 10px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        @media (max-width: 768px) {
            .hand-container {
                grid-template-columns: 1fr;
                max-height: 250px;
            }
        }
        
        .card-number {
            display: inline-block;
            background: #667eea;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            text-align: center;
            line-height: 24px;
            margin-right: 10px;
            font-weight: bold;
            font-size: 12px;
        }
        
        .player-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 10px 0;
            justify-content: center;
        }
        
        .player-card {
            background: #f5f5f5;
            padding: 8px;
            border-radius: 8px;
            text-align: center;
            min-width: 90px;
            position: relative;
            font-size: 12px;
        }
        
        .player-card.host::after {
            content: "üëë";
            position: absolute;
            top: -6px;
            right: -6px;
            background: gold;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
        }
        
        .player-card.judge::after {
            content: "‚öñÔ∏è";
            position: absolute;
            top: -6px;
            left: -6px;
            background: #4CAF50;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 10px;
        }
        
        .timer-container {
            text-align: center;
            margin: 10px 0;
            padding: 8px;
            background: #f5f5f5;
            border-radius: 8px;
        }
        
        .timer {
            font-size: 20px;
            font-weight: bold;
            color: #667eea;
        }
        
        .timer.warning {
            color: #ff9800;
        }
        
        .timer.danger {
            color: #f44336;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .points-display {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 8px;
            margin: 15px 0;
            padding: 12px;
            background: #f0f0f0;
            border-radius: 8px;
        }
        
        .point-item {
            text-align: center;
            min-width: 70px;
        }
        
        .point-value {
            font-size: 20px;
            font-weight: bold;
            color: #667eea;
        }
        
        .point-label {
            font-size: 11px;
            color: #666;
            margin-top: 3px;
        }
        
        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 15px 0;
            justify-content: center;
        }
        
        .winner-announcement {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            border-radius: 12px;
            margin: 15px 0;
            animation: pulse 2s infinite;
        }
        
        .judge-options {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin: 15px 0;
        }
        
        @media (min-width: 768px) {
            .judge-options {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }
        
        .judge-option {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .judge-option:hover {
            transform: translateY(-3px);
            border-color: #667eea;
        }
        
        .debug-panel {
            position: fixed;
            bottom: 5px;
            right: 5px;
            background: rgba(0,0,0,0.85);
            color: white;
            padding: 10px;
            border-radius: 8px;
            z-index: 9999;
            font-size: 11px;
            max-width: 250px;
            max-height: 300px;
            overflow-y: auto;
            border: 2px solid #4CAF50;
        }
        
        .tab-buttons {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin: 15px 0;
        }
        
        .tab-button {
            padding: 10px 15px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            color: #666;
            position: relative;
            flex: 1;
            text-align: center;
        }
        
        .tab-button.active {
            color: #667eea;
        }
        
        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: #667eea;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .collection-container {
            max-height: 350px;
            overflow-y: auto;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 10px;
            margin: 10px 0;
        }
        
        .collection-controls {
            display: flex;
            gap: 6px;
            justify-content: flex-end;
            margin-top: 8px;
        }
        
        .collection-controls button {
            padding: 4px 8px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
        }
        
        .deck-info {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 6px;
            margin: 8px 0;
            font-size: 13px;
            display: flex;
            justify-content: space-between;
        }
        
        .game-status {
            margin: 10px 0;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 8px;
            font-size: 13px;
            text-align: center;
        }
        
        .selected-count {
            background: #4CAF50;
            color: white;
            padding: 3px 6px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: bold;
            margin-left: 8px;
        }
        
        .multi-answer-container {
            background: #f8f9fa;
            border-radius: 6px;
            padding: 8px;
            margin: 8px 0;
        }
        
        .answer-item {
            background: white;
            border-left: 3px solid #667eea;
            margin: 6px 0;
            padding: 8px 12px;
            border-radius: 4px;
            display: flex;
            align-items: flex-start;
        }
        
        .answer-number {
            background: #667eea;
            color: white;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            text-align: center;
            line-height: 22px;
            margin-right: 10px;
            flex-shrink: 0;
            font-weight: bold;
            font-size: 12px;
        }
        
        .all-submissions-display {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 12px;
            margin: 15px 0;
        }
        
        .submission-item {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 10px;
            margin: 8px 0;
        }
        
        .share-section {
            background: #e8f5e9;
            border: 2px solid #4CAF50;
            border-radius: 8px;
            padding: 12px;
            margin: 15px 0;
        }
        
        .share-url {
            background: white;
            border: 1px solid #4CAF50;
            border-radius: 6px;
            padding: 8px;
            margin: 8px 0;
            word-break: break-all;
            font-family: monospace;
            font-size: 11px;
        }
        
        .compact-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            margin: 10px 0;
        }
        
        .compact-label {
            font-size: 13px;
            color: #666;
            min-width: 120px;
        }
        
        .compact-input {
            flex: 1;
            min-width: 200px;
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .compact-textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            resize: vertical;
            min-height: 80px;
            max-height: 150px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .stat-box {
            background: #f5f5f5;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            font-size: 11px;
            color: #666;
            margin-top: 2px;
        }
        
        .small-btn {
            padding: 6px 12px;
            font-size: 12px;
            margin: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Screen 1: Main Menu -->
        <div id="menuScreen" class="screen active">
            <div class="header">
                <h1 style="font-size: 24px;">üé¥ Cards Game</h1>
                <p style="color: #666; font-size: 14px;">Play with bots or share cards with friends!</p>
            </div>
            
            <div style="text-align: center; margin: 20px 0;">
                <div class="compact-row" style="justify-content: center;">
                    <div class="compact-label">Your Name:</div>
                    <input type="text" id="playerName" class="compact-input" 
                           placeholder="Enter your name" value="Player">
                </div>
                
                <div style="margin: 20px 0;">
                    <button class="btn btn-success" onclick="startSolitaireGame()">
                        üöÄ Start Game vs Bots
                    </button>
                    <button class="btn btn-secondary" onclick="showScreen('collection')">
                        üÉè Manage Cards
                    </button>
                    <button class="btn btn-warning" onclick="showScreen('create')">
                        ‚ú® Create Cards
                    </button>
                    <button class="btn btn-secondary" onclick="showScreen('share')">
                        üîó Share Cards
                    </button>
                </div>
                
                <!-- Card Stats -->
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="menuAnswerCount">0</div>
                        <div class="stat-label">Answer Cards</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="menuQuestionCount">0</div>
                        <div class="stat-label">Question Cards</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="menuCustomCount">0</div>
                        <div class="stat-label">Custom Cards</div>
                    </div>
                </div>
                
                <div style="margin-top: 20px; color: #666; font-size: 13px; padding: 0 10px;">
                    <p><strong>Quick Play:</strong></p>
                    <p>1. Enter your name above</p>
                    <p>2. Click "Start Game vs Bots"</p>
                    <p>3. Select cards and submit!</p>
                </div>
            </div>
        </div>
        
        <!-- Screen 2: Game Screen -->
        <div id="gameScreen" class="screen">
            <div class="header">
                <h2 style="font-size: 20px;">Round <span id="roundNumber">1</span></h2>
                <div class="timer-container">
                    <div id="timerDisplay" class="timer">45:00</div>
                    <div style="color: #666; font-size: 11px;">Time remaining</div>
                </div>
            </div>
            
            <div class="game-status">
                <strong>Status:</strong> <span id="statusText">Select a card from your hand</span>
                <span id="selectedCountInfo" class="selected-count"></span>
            </div>
            
            <div style="margin: 8px 0; padding: 6px 12px; background: #4CAF50; color: white; border-radius: 15px; display: inline-block; font-size: 12px; text-align: center; width: 100%;">
                ‚öñÔ∏è Judge: <span id="currentJudgeName">Loading...</span>
            </div>
            
            <!-- Question Display -->
            <div class="card black" id="questionDisplay">
                Loading question...
            </div>
            
            <!-- Deck Info -->
            <div class="deck-info">
                <div>
                    <strong>Answers:</strong> 
                    <span id="answerDeckCount">0</span> left
                    (<span id="answerDiscardCount">0</span> used)
                </div>
                <div>
                    <strong>Questions:</strong> 
                    <span id="questionDeckCount">0</span> left
                    (<span id="questionDiscardCount">0</span> used)
                </div>
            </div>
            
            <!-- Player List -->
            <div class="player-list" id="gamePlayers">
            </div>
            
            <!-- Score Display -->
            <div class="points-display">
                <div class="point-item">
                    <div class="point-value" id="playerScore">0</div>
                    <div class="point-label">Your Score</div>
                </div>
                <div class="point-item">
                    <div class="point-value">3</div>
                    <div class="point-label">Points to Win</div>
                </div>
                <div class="point-item">
                    <div class="point-value" id="cardsInHand">6</div>
                    <div class="point-label">Cards in Hand</div>
                </div>
            </div>
            
            <!-- Hand Display -->
            <h3 style="text-align: center; margin: 15px 0; font-size: 16px;">Your Hand (Click or type 1-6):</h3>
            <div class="hand-container" id="playerHand">
            </div>
            
            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn" onclick="submitCard()" id="submitBtn" disabled>
                    Submit Card
                </button>
                <button class="btn btn-warning" onclick="forceBotSubmission()">
                    Force Bots
                </button>
                <button class="btn" onclick="returnToMenu()">
                    Quit Game
                </button>
            </div>
        </div>
        
        <!-- Screen 3: Judging Screen -->
        <div id="judgingScreen" class="screen">
            <div class="header">
                <h2 style="font-size: 20px;">Judge Selection</h2>
                <div class="card black" id="judgeQuestion">
                    Loading question...
                </div>
                <p style="margin: 10px 0; font-size: 15px; color: #666;">
                    Select the best answer:
                </p>
                <div style="color: #4CAF50; font-weight: bold; padding: 6px 12px; background: #e8f5e9; border-radius: 15px; display: inline-block; font-size: 12px;">
                    ‚öñÔ∏è You are the Judge
                </div>
            </div>
            
            <div class="all-submissions-display">
                <h3 style="text-align: center; margin-bottom: 12px; color: #667eea; font-size: 16px;">All Submissions</h3>
                <div id="allSubmissions">
                </div>
            </div>
            
            <div class="judge-options" id="judgeOptions">
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-warning" onclick="forceRandomWinner()">
                    Pick Random Winner
                </button>
                <button class="btn" onclick="returnToMenu()">
                    Quit Game
                </button>
            </div>
        </div>
        
        <!-- Screen 4: Winner Screen -->
        <div id="winnerScreen" class="screen">
            <div class="winner-announcement">
                <h2 style="font-size: 22px;">üéâ Round Winner! üéâ</h2>
                <div id="winnerDetails" style="margin: 15px 0; font-size: 16px;">
                </div>
            </div>
            
            <div class="all-submissions-display">
                <h3 style="text-align: center; margin-bottom: 12px; color: #667eea; font-size: 16px;">All Submissions This Round</h3>
                <div id="winnerSubmissions">
                </div>
            </div>
            
            <div class="points-display">
                <div class="point-item">
                    <div class="point-value" id="winnerScore">0</div>
                    <div class="point-label">Winner's Score</div>
                </div>
                <div class="point-item">
                    <div class="point-value" id="roundsPlayed">1</div>
                    <div class="point-label">Rounds Played</div>
                </div>
                <div class="point-item">
                    <div class="point-value" id="deckSize">0</div>
                    <div class="point-label">Cards Left</div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-success" onclick="continueToNextRound()" id="nextRoundBtn">
                    Next Round
                </button>
                <button class="btn" onclick="returnToMenu()">
                    Back to Menu
                </button>
            </div>
        </div>
        
        <!-- Screen 5: Card Collection -->
        <div id="collectionScreen" class="screen">
            <div class="header">
                <h2 style="font-size: 22px;">üÉè Card Collection</h2>
                <p style="color: #666; margin-top: 8px; font-size: 14px;">Enable/disable or delete cards</p>
            </div>
            
            <div class="tab-buttons">
                <button class="tab-button active" onclick="switchCollectionTab('answers')">Answers</button>
                <button class="tab-button" onclick="switchCollectionTab('questions')">Questions</button>
            </div>
            
            <div id="answersTab" class="tab-content active">
                <div class="deck-info">
                    <span>Enabled: <span id="enabledAnswersCount">0</span>/<span id="totalAnswersCount">0</span></span>
                    <button class="small-btn btn-secondary" onclick="enableAllCards('answers')">
                        Enable All
                    </button>
                </div>
                
                <div class="collection-container" id="answerCollection">
                </div>
            </div>
            
            <div id="questionsTab" class="tab-content">
                <div class="deck-info">
                    <span>Enabled: <span id="enabledQuestionsCount">0</span>/<span id="totalQuestionsCount">0</span></span>
                    <button class="small-btn btn-secondary" onclick="enableAllCards('questions')">
                        Enable All
                    </button>
                </div>
                
                <div class="collection-container" id="questionCollection">
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn" onclick="showScreen('menu')">
                    Back to Menu
                </button>
            </div>
        </div>
        
        <!-- Screen 6: Create Cards -->
        <div id="createScreen" class="screen">
            <div class="header">
                <h2 style="font-size: 22px;">‚ú® Create Cards</h2>
                <p style="color: #666; margin-top: 8px; font-size: 14px;">Add custom cards to your collection</p>
            </div>
            
            <div class="tab-buttons">
                <button class="tab-button active" onclick="switchCreateTab('answer')">Answer Cards</button>
                <button class="tab-button" onclick="switchCreateTab('question')">Question Cards</button>
            </div>
            
            <div id="answerCreateTab" class="tab-content active">
                <div style="margin: 20px 0;">
                    <textarea id="answerCreateText" class="compact-textarea" 
                              placeholder="Enter your answer card text here..."></textarea>
                    
                    <button class="btn btn-success" onclick="createCard('answer')" style="margin-top: 15px; width: 100%;">
                        ‚úÖ Create Answer Card
                    </button>
                    
                    <div style="margin-top: 15px; color: #666; font-size: 12px;">
                        <p>üí° <strong>Tips:</strong> Keep it funny and short (under 50 characters)</p>
                    </div>
                </div>
            </div>
            
            <div id="questionCreateTab" class="tab-content">
                <div style="margin: 20px 0;">
                    <textarea id="questionCreateText" class="compact-textarea" 
                              placeholder="Enter your question with _____ for blanks..."></textarea>
                    
                    <div style="margin: 12px 0;">
                        <label style="font-size: 14px;">Blanks: <span style="color: #667eea; font-weight: bold;" id="createBlankCount">1</span></label>
                        <div style="margin-top: 8px;">
                            <button class="small-btn" onclick="addCreateBlank()">
                                + Add Blank
                            </button>
                            <button class="small-btn" onclick="removeCreateBlank()">
                                - Remove Blank
                            </button>
                        </div>
                    </div>
                    
                    <button class="btn btn-success" onclick="createCard('question')" style="margin-top: 15px; width: 100%;">
                        ‚úÖ Create Question Card
                    </button>
                    
                    <div style="margin-top: 15px; color: #666; font-size: 12px;">
                        <p>üí° <strong>Tips:</strong> Use _____ for blanks (1-3 blanks works best)</p>
                    </div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn" onclick="showScreen('menu')">
                    Back to Menu
                </button>
            </div>
        </div>
        
        <!-- Screen 7: Share Cards -->
        <div id="shareScreen" class="screen">
            <div class="header">
                <h2 style="font-size: 22px;">üîó Share Cards</h2>
                <p style="color: #666; margin-top: 8px; font-size: 14px;">Share your custom card collection</p>
            </div>
            
            <div class="share-section">
                <h3 style="font-size: 18px; margin-bottom: 10px;">üì§ Share via URL</h3>
                <p style="font-size: 13px; margin-bottom: 10px;">Generate a link that includes all your custom cards.</p>
                
                <button class="btn btn-success" onclick="generateShareLink()" style="margin: 8px 0; width: 100%;">
                    üîó Generate Share Link
                </button>
                
                <div id="shareLinkContainer" style="display: none;">
                    <p style="font-size: 13px; margin: 10px 0 5px 0;"><strong>Share this link:</strong></p>
                    <div class="share-url" id="shareUrl"></div>
                    <button class="btn btn-secondary" onclick="copyShareLink()" style="margin: 8px 0; width: 100%;">
                        üìã Copy Link
                    </button>
                </div>
            </div>
            
            <div class="share-section">
                <h3 style="font-size: 18px; margin-bottom: 10px;">üì• Import Cards</h3>
                <p style="font-size: 13px; margin-bottom: 10px;">Paste a share URL to import cards:</p>
                
                <input type="text" id="importUrl" class="compact-input" 
                       placeholder="Paste share URL here..." 
                       style="margin: 8px 0; width: 100%;">
                
                <button class="btn btn-success" onclick="importFromUrl()" style="width: 100%;">
                    üì• Import Cards from URL
                </button>
            </div>
            
            <div class="share-section">
                <h3 style="font-size: 18px; margin-bottom: 10px;">üíæ File Export/Import</h3>
                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <button class="btn btn-secondary" onclick="exportCardsToFile()" style="flex: 1;">
                        üì§ Export to File
                    </button>
                    <button class="btn btn-secondary" onclick="importCardsFromFile()" style="flex: 1;">
                        üì• Import from File
                    </button>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn" onclick="showScreen('menu')">
                    Back to Menu
                </button>
            </div>
        </div>
    </div>

    <script>
        // ==================== GAME STATE ====================
        let gameState = {
            playerName: "Player",
            players: [],
            currentRound: 1,
            hand: [],
            selectedCards: [],
            gamePhase: "menu",
            isJudge: false,
            deck: [],
            discardDeck: [],
            questionDeck: [],
            questionDiscard: [],
            cardCollection: {
                answers: [],
                questions: []
            },
            submittedCards: [],
            scores: {},
            winningScore: 3,
            currentBlankCount: 1,
            activeQuestion: null,
            timeLimit: 45,
            timerRunning: false,
            timeLeft: 45,
            timerInterval: null,
            currentJudgeIndex: 0,
            playerHasSubmitted: false,
            gameActive: false
        };
        
        let bots = {};
        
        // ==================== LARGE DEFAULT COLLECTION ====================
        const DEFAULT_ANSWERS = [
            "A fart so powerful it wakes the dead.",
            "My weird uncle.",
            "Getting drunk on mouthwash.",
            "The miracle of childbirth.",
            "Peeing a little bit.",
            "A lifetime of regrets.",
            "Forgetting to wear pants.",
            "Selling my soul for internet fame.",
            "A suspicious rash.",
            "Cheating at Scrabble.",
            "An awkward silence.",
            "Bad decisions.",
            "The sound of children laughing.",
            "Free samples.",
            "My ex.",
            "Regret.",
            "Spaghetti.",
            "My collection of toenail clippings.",
            "Daddy issues.",
            "The patriarchy.",
            "A disappointing birthday party.",
            "Running with scissors.",
            "The entire state of Nebraska.",
            "That thing politicians do with their thumbs.",
            "Being rich.",
            "Screaming into the void.",
            "My bad attitude.",
            "Getting fingered.",
            "Grandma's ashes.",
            "The art of seduction.",
            "The Blood of Christ.",
            "One trillion dollars.",
            "Chunks of dead prostitute.",
            "A lifetime of sadness.",
            "Hormone injections.",
            "Dying alone.",
            "My good bra.",
            "Poor life choices.",
            "Cockfights.",
            "The invisible hand.",
            "Ethnic cleansing.",
            "My first kiss.",
            "Amputees.",
            "The heart of a child.",
            "Child beauty pageants.",
            "Sean Connery.",
            "An endless stream of diarrhea.",
            "The miracle of childbirth.",
            "Famine.",
            "Flesh-eating bacteria.",
            "Cultural appropriation.",
            "A balanced breakfast.",
            "Old-people smell.",
            "My cheating son-of-a-bitch husband.",
            "Pelvic thrusts.",
            "Stranger danger.",
            "Dying of dysentery.",
            "A really cool hat.",
            "The primal, ball-slapping sex your parents are having right now.",
            "A big black dick.",
            "A bigger, blacker dick.",
            "The biggest, blackest dick.",
            "A sad handjob.",
            "Police brutality.",
            "Passive-aggressive Post-it notes.",
            "Poverty.",
            "Winking at old people.",
            "Wiping her butt.",
            "Golden showers.",
            "Racism.",
            "Powerful thighs.",
            "My genitals.",
            "Preteens.",
            "More elephant cock than I bargained for.",
            "A micropenis.",
            "My ugly face and bad personality.",
            "A good sniff.",
            "Incest.",
            "Agriculture.",
            "Foreskin.",
            "A homoerotic volleyball montage.",
            "Actually taking candy from a baby.",
            "Crystal meth.",
            "Exactly what you'd expect.",
            "Natural male enhancement.",
            "Poor people.",
            "The violation of our most basic human rights.",
            "Viagra.",
            "Self-loathing.",
            "Spectacular abs.",
            "An honest cop with nothing left to lose.",
            "Abstinence.",
            "A balanced diet.",
            "Mild autism.",
            "Necrophilia.",
            "A can of whoop-ass.",
            "A windmill full of corpses.",
            "Whipping it out.",
            "Academy Award winner Meryl Streep.",
            "Obesity.",
            "Object permanence.",
            "Opposable thumbs.",
            "Riding off into the sunset.",
            "The hiccups.",
            "The Holy Bible.",
            "Puberty."
        ];
        
        const DEFAULT_QUESTIONS = [
            "What's that smell? _____",
            "What ruined the bachelor party? _____",
            "What's Grandpa hiding in the attic? _____",
            "What's the secret to a happy marriage? _____",
            "What did I bring back from Mexico? _____",
            "What's my secret power? _____",
            "What never fails to make me smile? _____",
            "What's in my basement? _____",
            "What's the worst gift I've ever received? _____",
            "What do I bring to a potluck? _____",
            "What's the next superhero movie about? _____",
            "What ended my last relationship? _____",
            "What's always on my Christmas list? _____",
            "What's my guilty pleasure? _____",
            "What will I bring back in time to convince people I'm a god? _____",
            "What would grandma find disturbing, yet oddly charming? _____",
            "What helps Obama unwind? _____",
            "What did I exchange my soul for? _____",
            "What's the new fad diet? _____",
            "What gives me uncontrollable gas? _____",
            "What do old people smell like? _____",
            "What am I giving up for Lent? _____",
            "What's that sound? _____",
            "What made my first kiss so awkward? _____",
            "What never fails to liven up the party? _____",
            "What will always get you laid? _____",
            "What would I wish for if I had three wishes? _____",
            "What's the best way to get over a breakup? _____",
            "What's hiding under my bed? _____",
            "What's the secret to a long life? _____",
            "What's my spirit animal? _____",
            "What's the worst thing to find in your hotel room? _____",
            "What's the best thing about waking up early? _____",
            "What's my go-to karaoke song? _____",
            "What's the key to success? _____",
            "What's in my secret stash? _____",
            "What's the real reason I got fired? _____",
            "What's my super villain origin story? _____",
            "What's the best part of waking up? _____",
            "What's my favorite childhood memory? _____",
            "What's the meaning of life? _____",
            "What's the worst thing you can say on a first date? _____",
            "What's my hidden talent? _____",
            "What's the secret ingredient in my famous chili? _____",
            "What's my biggest regret? _____"
        ];
        
        // ==================== INITIALIZATION ====================
        function initializeCardCollection() {
            const savedCollection = localStorage.getItem('cardCollection');
            
            if (savedCollection) {
                gameState.cardCollection = JSON.parse(savedCollection);
                console.log("üì¶ Loaded saved card collection");
            } else {
                // Create default collection
                gameState.cardCollection = {
                    answers: DEFAULT_ANSWERS.map(text => ({
                        text: text,
                        enabled: true,
                        isDefault: true
                    })),
                    questions: DEFAULT_QUESTIONS.map(text => ({
                        text: text,
                        enabled: true,
                        isDefault: true
                    }))
                };
                saveCardCollection();
                console.log("üì¶ Created default card collection");
            }
            
            updateMenuStats();
        }
        
        function saveCardCollection() {
            localStorage.setItem('cardCollection', JSON.stringify(gameState.cardCollection));
            updateMenuStats();
        }
        
        function updateMenuStats() {
            const totalAnswers = gameState.cardCollection.answers.length;
            const totalQuestions = gameState.cardCollection.questions.length;
            const customAnswers = gameState.cardCollection.answers.filter(c => !c.isDefault).length;
            const customQuestions = gameState.cardCollection.questions.filter(c => !c.isDefault).length;
            
            document.getElementById('menuAnswerCount').textContent = totalAnswers;
            document.getElementById('menuQuestionCount').textContent = totalQuestions;
            document.getElementById('menuCustomCount').textContent = customAnswers + customQuestions;
        }
        
        // ==================== DECK MANAGEMENT ====================
        function initializeDecks() {
            // Build answer deck from ENABLED cards only
            const enabledAnswers = gameState.cardCollection.answers
                .filter(card => card.enabled)
                .map(card => card.text);
            
            // Build question deck from ENABLED cards only
            const enabledQuestions = gameState.cardCollection.questions
                .filter(card => card.enabled)
                .map(card => card.text);
            
            // Shuffle decks
            gameState.deck = shuffleArray([...enabledAnswers]);
            gameState.questionDeck = shuffleArray([...enabledQuestions]);
            
            // Reset discard piles
            gameState.discardDeck = [];
            gameState.questionDiscard = [];
            
            console.log("üÉè Decks initialized with", gameState.deck.length, "answers and", gameState.questionDeck.length, "questions");
            updateDeckInfo();
        }
        
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }
        
        function drawAnswerCard() {
            if (gameState.deck.length === 0) {
                reshuffleDecks();
            }
            
            if (gameState.deck.length === 0) {
                console.warn("‚ö†Ô∏è No answer cards available!");
                return null;
            }
            
            const card = gameState.deck.shift();
            gameState.discardDeck.push(card);
            updateDeckInfo();
            return card;
        }
        
        function drawQuestionCard() {
            if (gameState.questionDeck.length === 0) {
                reshuffleDecks();
            }
            
            if (gameState.questionDeck.length === 0) {
                console.warn("‚ö†Ô∏è No question cards available!");
                return DEFAULT_QUESTIONS[0]; // Fallback
            }
            
            const card = gameState.questionDeck.shift();
            gameState.questionDiscard.push(card);
            updateDeckInfo();
            return card;
        }
        
        function reshuffleDecks() {
            console.log("üîÑ Reshuffling decks...");
            
            if (gameState.discardDeck.length > 0) {
                gameState.deck = shuffleArray([...gameState.discardDeck]);
                gameState.discardDeck = [];
            }
            
            if (gameState.questionDiscard.length > 0) {
                gameState.questionDeck = shuffleArray([...gameState.questionDiscard]);
                gameState.questionDiscard = [];
            }
            
            // If still empty, reinitialize from collection
            if (gameState.deck.length === 0) {
                const enabledAnswers = gameState.cardCollection.answers
                    .filter(card => card.enabled)
                    .map(card => card.text);
                gameState.deck = shuffleArray([...enabledAnswers]);
            }
            
            if (gameState.questionDeck.length === 0) {
                const enabledQuestions = gameState.cardCollection.questions
                    .filter(card => card.enabled)
                    .map(card => card.text);
                gameState.questionDeck = shuffleArray([...enabledQuestions]);
            }
            
            updateDeckInfo();
        }
        
        // ==================== GAME START - FIXED ====================
        function startSolitaireGame() {
            console.log("üéÆ Starting solitaire game...");
            
            const playerName = document.getElementById('playerName').value.trim() || "Player";
            gameState.playerName = playerName;
            
            // Initialize decks FIRST - this was missing!
            initializeDecks();
            
            // Reset game state
            gameState.players = [];
            gameState.currentRound = 1;
            gameState.hand = [];
            gameState.selectedCards = [];
            gameState.submittedCards = [];
            gameState.scores = {};
            gameState.playerHasSubmitted = false;
            gameState.currentJudgeIndex = 0;
            gameState.gameActive = true;
            gameState.gamePhase = "playing";
            
            // Create players
            const humanPlayer = {
                id: 'player_human',
                name: playerName,
                isHost: true,
                score: 0,
                isBot: false
            };
            
            const bot1 = {
                id: 'bot_alice',
                name: 'Bot Alice',
                isHost: false,
                score: 0,
                isBot: true
            };
            
            const bot2 = {
                id: 'bot_bob',
                name: 'Bot Bob',
                isHost: false,
                score: 0,
                isBot: true
            };
            
            gameState.players = [humanPlayer, bot1, bot2];
            
            // Initialize scores
            gameState.players.forEach(player => {
                gameState.scores[player.id] = 0;
            });
            
            // Initialize bots
            bots = {};
            const personalities = ['funny', 'risky', 'safe', 'random'];
            
            gameState.players.forEach(player => {
                if (player.isBot) {
                    const personality = personalities[Math.floor(Math.random() * personalities.length)];
                    bots[player.id] = new SmartBot(player.id, player.name, personality);
                }
            });
            
            // Random judge
            gameState.currentJudgeIndex = Math.floor(Math.random() * gameState.players.length);
            gameState.isJudge = (gameState.players[gameState.currentJudgeIndex].id === 'player_human');
            
            console.log("Judge:", gameState.players[gameState.currentJudgeIndex].name);
            console.log("Total cards in deck:", gameState.deck.length, "answers and", gameState.questionDeck.length, "questions");
            
            // Deal hands
            dealHands();
            
            // Start first round
            startRound();
            
            // Show game screen
            showScreen('game');
        }
        
        class SmartBot {
            constructor(id, name, personality = 'random') {
                this.id = id;
                this.name = name;
                this.personality = personality;
                this.hand = [];
                this.isBot = true;
                this.hasSubmitted = false;
                this.memory = [];
            }
            
            setHand(cards) {
                this.hand = [...cards];
                this.hasSubmitted = false;
            }
            
            refillHand() {
                while (this.hand.length < 6) {
                    const card = drawAnswerCard();
                    if (card) {
                        this.hand.push(card);
                    } else {
                        break;
                    }
                }
            }
            
            selectCards(blankCount) {
                const scoredCards = this.hand.map((card, index) => {
                    let score = Math.random() * 10;
                    return { index, card, score };
                });
                
                scoredCards.sort((a, b) => b.score - a.score);
                const selected = scoredCards.slice(0, blankCount).map(c => c.index);
                
                if (selected.length === 0 && this.hand.length > 0) {
                    const indices = [];
                    while (indices.length < Math.min(blankCount, this.hand.length)) {
                        const randomIndex = Math.floor(Math.random() * this.hand.length);
                        if (!indices.includes(randomIndex)) {
                            indices.push(randomIndex);
                        }
                    }
                    return indices;
                }
                
                return selected;
            }
            
            getSubmissionText(selectedIndices) {
                if (selectedIndices.length === 0) return "No card selected";
                if (selectedIndices.length === 1) {
                    return this.hand[selectedIndices[0]];
                } else {
                    return selectedIndices.map(idx => this.hand[idx]);
                }
            }
            
            removeSelectedCards(selectedIndices) {
                const sortedIndices = [...selectedIndices].sort((a, b) => b - a);
                sortedIndices.forEach(index => {
                    if (index >= 0 && index < this.hand.length) {
                        this.rememberCard(this.hand[index]);
                        this.hand.splice(index, 1);
                    }
                });
            }
            
            rememberCard(card) {
                this.memory.push(card);
                if (this.memory.length > 10) {
                    this.memory.shift();
                }
            }
        }
        
        function dealHands() {
            // Deal to human
            gameState.hand = [];
            for (let i = 0; i < 6; i++) {
                const card = drawAnswerCard();
                if (card) {
                    gameState.hand.push(card);
                }
            }
            
            // Deal to bots
            Object.values(bots).forEach(bot => {
                const hand = [];
                for (let i = 0; i < 6; i++) {
                    const card = drawAnswerCard();
                    if (card) {
                        hand.push(card);
                    }
                }
                bot.setHand(hand);
            });
            
            updatePlayerHand();
            updateGamePlayers();
            updateDeckInfo();
        }
        
        // ==================== GAME FUNCTIONS ====================
        function startRound() {
            gameState.gamePhase = "playing";
            gameState.submittedCards = [];
            gameState.selectedCards = [];
            gameState.playerHasSubmitted = false;
            
            // Get question
            const question = drawQuestionCard();
            gameState.activeQuestion = question;
            gameState.currentBlankCount = (question.match(/_____/g) || []).length || 1;
            
            // Reset bot submission status
            Object.values(bots).forEach(bot => {
                bot.hasSubmitted = false;
            });
            
            // Update UI
            document.getElementById('questionDisplay').textContent = question;
            document.getElementById('roundNumber').textContent = gameState.currentRound;
            document.getElementById('currentJudgeName').textContent = gameState.players[gameState.currentJudgeIndex].name;
            document.getElementById('nextRoundBtn').style.display = 'inline-block';
            
            updateStatusText();
            startTimer();
            updateGameUI();
        }
        
        function startTimer() {
            stopTimer();
            gameState.timeLeft = gameState.timeLimit;
            gameState.timerRunning = true;
            
            updateTimerDisplay();
            
            gameState.timerInterval = setInterval(() => {
                gameState.timeLeft--;
                updateTimerDisplay();
                
                if (gameState.timeLeft <= 0) {
                    stopTimer();
                    if (!gameState.playerHasSubmitted && !gameState.isJudge) {
                        autoSubmitCard();
                    }
                    setTimeout(checkIfReadyForJudging, 1000);
                }
            }, 1000);
        }
        
        function stopTimer() {
            gameState.timerRunning = false;
            if (gameState.timerInterval) {
                clearInterval(gameState.timerInterval);
                gameState.timerInterval = null;
            }
        }
        
        function updateTimerDisplay() {
            const timerDisplay = document.getElementById('timerDisplay');
            if (!timerDisplay) return;
            
            if (!gameState.timerRunning) {
                timerDisplay.textContent = "--:--";
                return;
            }
            
            const minutes = Math.floor(gameState.timeLeft / 60);
            const seconds = gameState.timeLeft % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            if (gameState.timeLeft <= 10) {
                timerDisplay.className = 'timer danger';
            } else if (gameState.timeLeft <= 30) {
                timerDisplay.className = 'timer warning';
            } else {
                timerDisplay.className = 'timer';
            }
        }
        
        function updatePlayerHand() {
            const handContainer = document.getElementById('playerHand');
            if (!handContainer) return;
            
            handContainer.innerHTML = '';
            
            gameState.hand.forEach((card, index) => {
                const cardDiv = document.createElement('div');
                cardDiv.className = 'card';
                if (gameState.selectedCards.includes(index)) {
                    cardDiv.classList.add('selected');
                }
                
                cardDiv.innerHTML = `
                    <div class="card-number">${index + 1}</div>
                    <div style="display: inline-block; font-size: 14px;">${card}</div>
                `;
                
                cardDiv.onclick = () => selectCard(index);
                handContainer.appendChild(cardDiv);
            });
            
            document.getElementById('cardsInHand').textContent = gameState.hand.length;
            updateSubmitButton();
        }
        
        function selectCard(index) {
            if (gameState.isJudge) {
                alert("You are the judge! You cannot submit cards this round.");
                return;
            }
            
            if (gameState.playerHasSubmitted) {
                alert("You have already submitted for this round!");
                return;
            }
            
            if (gameState.selectedCards.includes(index)) {
                gameState.selectedCards = gameState.selectedCards.filter(i => i !== index);
            } else {
                if (gameState.selectedCards.length < gameState.currentBlankCount) {
                    gameState.selectedCards.push(index);
                } else {
                    alert(`You can only select ${gameState.currentBlankCount} card(s) for this question. Deselect one first.`);
                    return;
                }
            }
            
            updatePlayerHand();
            updateStatusText();
        }
        
        function updateStatusText() {
            const statusText = document.getElementById('statusText');
            const selectedCountInfo = document.getElementById('selectedCountInfo');
            
            if (gameState.isJudge) {
                statusText.textContent = "You are the judge. Waiting for submissions...";
                selectedCountInfo.textContent = "";
            } else if (gameState.playerHasSubmitted) {
                statusText.textContent = "Card submitted! Waiting for bots...";
                selectedCountInfo.textContent = "";
            } else {
                statusText.textContent = "Select card(s) from your hand";
                selectedCountInfo.textContent = `${gameState.selectedCards.length}/${gameState.currentBlankCount}`;
            }
        }
        
        function updateSubmitButton() {
            const submitBtn = document.getElementById('submitBtn');
            if (!submitBtn) return;
            
            if (gameState.isJudge) {
                submitBtn.disabled = true;
                submitBtn.textContent = "Judge (Cannot Submit)";
                return;
            }
            
            if (gameState.playerHasSubmitted) {
                submitBtn.disabled = true;
                submitBtn.textContent = "Already Submitted";
                return;
            }
            
            const hasEnoughCards = gameState.selectedCards.length === gameState.currentBlankCount;
            submitBtn.disabled = !hasEnoughCards;
            submitBtn.textContent = hasEnoughCards ? 
                `Submit Card (${gameState.selectedCards.length} selected)` : 
                `Select ${gameState.currentBlankCount} Card(s)`;
        }
        
        function submitCard() {
            if (gameState.isJudge) {
                alert("You are the judge! You cannot submit cards this round.");
                return;
            }
            
            if (gameState.selectedCards.length !== gameState.currentBlankCount) {
                alert(`Please select exactly ${gameState.currentBlankCount} card(s) for this question.`);
                return;
            }
            
            if (gameState.playerHasSubmitted) {
                alert("You have already submitted for this round!");
                return;
            }
            
            const selectedCardTexts = gameState.selectedCards.map(index => gameState.hand[index]);
            
            const sortedIndices = [...gameState.selectedCards].sort((a, b) => b - a);
            sortedIndices.forEach(index => {
                gameState.hand.splice(index, 1);
            });
            
            for (let i = 0; i < sortedIndices.length; i++) {
                const newCard = drawAnswerCard();
                if (newCard) {
                    gameState.hand.push(newCard);
                }
            }
            
            gameState.submittedCards.push({
                player: gameState.playerName,
                playerId: 'player_human',
                card: selectedCardTexts.length === 1 ? selectedCardTexts[0] : selectedCardTexts
            });
            
            gameState.playerHasSubmitted = true;
            gameState.selectedCards = [];
            
            updatePlayerHand();
            updateStatusText();
            updateDeckInfo();
            updateGamePlayers();
            
            setTimeout(() => {
                submitBotsCards();
            }, 1500);
        }
        
        function submitBotsCards() {
            Object.values(bots).forEach(bot => {
                if (bot.hasSubmitted) return;
                
                const isBotJudge = gameState.players[gameState.currentJudgeIndex].id === bot.id;
                if (isBotJudge) return;
                
                const selectedIndices = bot.selectCards(gameState.currentBlankCount);
                if (selectedIndices.length === 0) return;
                
                const submissionCards = bot.getSubmissionText(selectedIndices);
                
                gameState.submittedCards.push({
                    player: bot.name,
                    playerId: bot.id,
                    card: submissionCards
                });
                
                bot.removeSelectedCards(selectedIndices);
                bot.refillHand();
                bot.hasSubmitted = true;
            });
            
            updateGamePlayers();
            updateDeckInfo();
            
            setTimeout(checkIfReadyForJudging, 1000);
        }
        
        function forceBotSubmission() {
            submitBotsCards();
        }
        
        function checkIfReadyForJudging() {
            if (gameState.gamePhase !== 'playing') return;
            
            const judge = gameState.players[gameState.currentJudgeIndex];
            if (!judge) return;
            
            const playersWhoShouldSubmit = gameState.players.filter(p => p.id !== judge.id);
            const submittedPlayerIds = gameState.submittedCards.map(s => s.playerId);
            
            const allSubmitted = playersWhoShouldSubmit.every(player => 
                submittedPlayerIds.includes(player.id)
            );
            
            if (allSubmitted && playersWhoShouldSubmit.length > 0) {
                startJudging();
            } else {
                setTimeout(checkIfReadyForJudging, 1000);
            }
        }
        
        function startJudging() {
            gameState.gamePhase = "judging";
            stopTimer();
            
            if (gameState.isJudge) {
                showScreen('judging');
                displayJudgeOptions();
                displayAllSubmissions('allSubmissions');
            } else {
                setTimeout(() => {
                    if (gameState.submittedCards.length > 0) {
                        const randomIndex = Math.floor(Math.random() * gameState.submittedCards.length);
                        selectWinner(randomIndex);
                    }
                }, 2000);
            }
        }
        
        function displayAllSubmissions(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            container.innerHTML = '';
            
            gameState.submittedCards.forEach((submission, index) => {
                const submissionDiv = document.createElement('div');
                submissionDiv.className = 'submission-item';
                
                let answersHTML = '';
                if (Array.isArray(submission.card)) {
                    answersHTML = `
                        <div class="multi-answer-container">
                            ${submission.card.map((card, i) => `
                                <div class="answer-item">
                                    <div class="answer-number">${i + 1}</div>
                                    <div style="font-size: 14px;">${card}</div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                } else {
                    answersHTML = `<div style="font-size: 15px; margin: 6px 0;">${submission.card}</div>`;
                }
                
                submissionDiv.innerHTML = `
                    <div style="font-weight: bold; color: #667eea; margin-bottom: 4px; font-size: 14px;">
                        Submission ${index + 1} - ${submission.player}
                    </div>
                    ${answersHTML}
                `;
                
                container.appendChild(submissionDiv);
            });
        }
        
        function displayJudgeOptions() {
            const question = gameState.activeQuestion || "What's that smell? _____";
            document.getElementById('judgeQuestion').textContent = question;
            
            const optionsContainer = document.getElementById('judgeOptions');
            optionsContainer.innerHTML = '';
            
            gameState.submittedCards.forEach((submission, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'judge-option';
                
                let answersHTML = '';
                if (Array.isArray(submission.card)) {
                    answersHTML = `
                        <div class="multi-answer-container">
                            ${submission.card.map((card, i) => `
                                <div class="answer-item">
                                    <div class="answer-number">${i + 1}</div>
                                    <div style="font-size: 14px;">${card}</div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                } else {
                    answersHTML = `<div style="font-size: 15px; margin: 6px 0;">${submission.card}</div>`;
                }
                
                optionDiv.innerHTML = `
                    <div style="font-size: 18px; color: #667eea; margin-bottom: 6px;">Option ${index + 1}</div>
                    ${answersHTML}
                    <div style="color: #666; font-size: 12px; margin-top: 6px;">From: ${submission.player}</div>
                `;
                
                optionDiv.onclick = () => selectWinner(index);
                optionsContainer.appendChild(optionDiv);
            });
        }
        
        function selectWinner(index) {
            if (index < 0 || index >= gameState.submittedCards.length) return;
            
            const winner = gameState.submittedCards[index];
            
            if (gameState.scores[winner.playerId] !== undefined) {
                gameState.scores[winner.playerId]++;
            } else {
                gameState.scores[winner.playerId] = 1;
            }
            
            const gameWinner = checkForGameWinner();
            
            gameState.currentJudgeIndex = (gameState.currentJudgeIndex + 1) % gameState.players.length;
            gameState.isJudge = (gameState.players[gameState.currentJudgeIndex].id === 'player_human');
            
            showWinnerScreen(winner, gameWinner);
        }
        
        function forceRandomWinner() {
            if (gameState.submittedCards.length === 0) {
                alert("No submissions to judge!");
                return;
            }
            
            const randomIndex = Math.floor(Math.random() * gameState.submittedCards.length);
            selectWinner(randomIndex);
        }
        
        function checkForGameWinner() {
            for (const [playerId, score] of Object.entries(gameState.scores)) {
                if (score >= gameState.winningScore) {
                    return playerId;
                }
            }
            return null;
        }
        
        function showWinnerScreen(winner, gameWinner) {
            gameState.gamePhase = "winner";
            
            displayAllSubmissions('winnerSubmissions');
            
            let winnerText = '';
            if (Array.isArray(winner.card)) {
                winnerText = winner.card.map((card, i) => `
                    <div style="margin: 4px 0; padding-left: 15px;">
                        <span style="color: #FFD700; font-weight: bold;">${i + 1}.</span> ${card}
                    </div>
                `).join('');
            } else {
                winnerText = `<div style="font-size: 18px; margin: 8px 0;">"${winner.card}"</div>`;
            }
            
            document.getElementById('winnerDetails').innerHTML = `
                <div style="color: #4CAF50; font-weight: bold; font-size: 16px;">Winner: ${winner.player}</div>
                ${winnerText}
                <div style="margin-top: 8px; color: #4CAF50; font-weight: bold;">üéâ Round Winner! üéâ</div>
            `;
            
            const winnerScore = gameState.scores[winner.playerId] || 0;
            document.getElementById('winnerScore').textContent = winnerScore;
            document.getElementById('roundsPlayed').textContent = gameState.currentRound;
            document.getElementById('deckSize').textContent = gameState.deck.length;
            
            if (gameWinner) {
                const winnerPlayer = gameState.players.find(p => p.id === gameWinner);
                if (winnerPlayer) {
                    document.getElementById('winnerDetails').innerHTML += `
                        <div style="margin-top: 15px; font-size: 20px; color: #FFD700;">
                            üèÜ GAME WINNER: ${winnerPlayer.name}! üèÜ
                        </div>
                        <div style="color: #666; font-size: 14px;">Final Score: ${gameState.scores[gameWinner]} points</div>
                    `;
                    document.getElementById('nextRoundBtn').style.display = 'none';
                    gameState.gameActive = false;
                }
            } else {
                document.getElementById('nextRoundBtn').style.display = 'inline-block';
            }
            
            showScreen('winner');
        }
        
        function continueToNextRound() {
            if (!gameState.gameActive) {
                alert("Game has ended. Start a new game from the menu.");
                return;
            }
            
            gameState.currentRound++;
            gameState.submittedCards = [];
            gameState.selectedCards = [];
            gameState.playerHasSubmitted = false;
            
            Object.values(bots).forEach(bot => {
                bot.hasSubmitted = false;
            });
            
            while (gameState.hand.length < 6) {
                const card = drawAnswerCard();
                if (card) {
                    gameState.hand.push(card);
                } else {
                    break;
                }
            }
            
            Object.values(bots).forEach(bot => {
                bot.refillHand();
            });
            
            startRound();
            showScreen('game');
        }
        
        function updateDeckInfo() {
            document.getElementById('answerDeckCount').textContent = gameState.deck.length;
            document.getElementById('answerDiscardCount').textContent = gameState.discardDeck.length;
            document.getElementById('questionDeckCount').textContent = gameState.questionDeck.length;
            document.getElementById('questionDiscardCount').textContent = gameState.questionDiscard.length;
        }
        
        function updateGameUI() {
            document.getElementById('playerScore').textContent = gameState.scores['player_human'] || 0;
            document.getElementById('roundNumber').textContent = gameState.currentRound;
            updateDeckInfo();
        }
        
        function updateGamePlayers() {
            const container = document.getElementById('gamePlayers');
            if (!container) return;
            
            container.innerHTML = '';
            
            gameState.players.forEach(player => {
                const playerDiv = document.createElement('div');
                playerDiv.className = `player-card ${player.id === 'player_human' ? 'host' : ''} ${gameState.players[gameState.currentJudgeIndex].id === player.id ? 'judge' : ''}`;
                
                const hasSubmitted = gameState.submittedCards.some(s => s.playerId === player.id);
                
                playerDiv.innerHTML = `
                    <div style="font-weight: bold; font-size: 13px;">${player.name}</div>
                    <div class="score-display" style="font-size: 14px;">Score: ${gameState.scores[player.id] || 0}</div>
                    <div style="font-size: 11px; color: ${hasSubmitted ? '#4CAF50' : '#f44336'}; margin-top: 2px;">
                        ${hasSubmitted ? '‚úÖ Submitted' : '‚è≥ Waiting'}
                    </div>
                `;
                
                container.appendChild(playerDiv);
            });
        }
        
        // ==================== CREATE CARDS ====================
        function createCard(type) {
            let textarea, collection;
            
            if (type === 'answer') {
                textarea = document.getElementById('answerCreateText');
                collection = gameState.cardCollection.answers;
            } else {
                textarea = document.getElementById('questionCreateText');
                collection = gameState.cardCollection.questions;
            }
            
            const cardText = textarea.value.trim();
            
            if (!cardText) {
                alert("Please enter card text");
                return;
            }
            
            const alreadyExists = collection.some(card => 
                card.text.toLowerCase() === cardText.toLowerCase()
            );
            
            if (alreadyExists) {
                alert("This card already exists in your collection!");
                return;
            }
            
            collection.push({
                text: cardText,
                enabled: true,
                isDefault: false
            });
            
            saveCardCollection();
            
            textarea.value = '';
            if (type === 'question') {
                document.getElementById('createBlankCount').textContent = '1';
            }
            
            alert("‚úÖ Card added to your collection!");
            
            if (document.getElementById('collectionScreen').classList.contains('active')) {
                refreshCollection();
            }
            
            updateMenuStats();
            console.log("Created new", type, "card:", cardText);
        }
        
        function addCreateBlank() {
            const textarea = document.getElementById('questionCreateText');
            textarea.value = textarea.value + ' _____';
            document.getElementById('createBlankCount').textContent = 
                parseInt(document.getElementById('createBlankCount').textContent) + 1;
        }
        
        function removeCreateBlank() {
            const textarea = document.getElementById('questionCreateText');
            const blankCount = document.getElementById('createBlankCount');
            
            if (parseInt(blankCount.textContent) <= 1) return;
            
            const text = textarea.value;
            const lastBlankIndex = text.lastIndexOf('_____');
            if (lastBlankIndex !== -1) {
                textarea.value = text.substring(0, lastBlankIndex).trim();
                blankCount.textContent = parseInt(blankCount.textContent) - 1;
            }
        }
        
        // ==================== SHARING SYSTEM ====================
        function generateShareLink() {
            const customCards = {
                answers: gameState.cardCollection.answers
                    .filter(card => !card.isDefault && card.enabled)
                    .map(card => card.text),
                questions: gameState.cardCollection.questions
                    .filter(card => !card.isDefault && card.enabled)
                    .map(card => card.text)
            };
            
            if (customCards.answers.length === 0 && customCards.questions.length === 0) {
                alert("You haven't created any custom cards yet! Create some cards first.");
                return;
            }
            
            const shareData = {
                v: '1.0',
                d: new Date().toISOString().split('T')[0],
                a: customCards.answers,
                q: customCards.questions
            };
            
            const jsonString = JSON.stringify(shareData);
            const compressed = btoa(encodeURIComponent(jsonString));
            
            const currentUrl = window.location.origin + window.location.pathname;
            const shareUrl = `${currentUrl}?cards=${compressed}`;
            
            document.getElementById('shareUrl').textContent = shareUrl;
            document.getElementById('shareLinkContainer').style.display = 'block';
        }
        
        function copyShareLink() {
            const shareUrl = document.getElementById('shareUrl').textContent;
            navigator.clipboard.writeText(shareUrl).then(() => {
                alert("‚úÖ Link copied to clipboard! Send this to your friends.");
            }).catch(() => {
                prompt("Copy this link:", shareUrl);
            });
        }
        
        function importFromUrl() {
            const urlInput = document.getElementById('importUrl').value.trim();
            
            if (!urlInput) {
                alert("Please paste a share URL");
                return;
            }
            
            try {
                const url = new URL(urlInput);
                const cardsParam = url.searchParams.get('cards');
                
                if (!cardsParam) {
                    alert("This URL doesn't contain any cards to import");
                    return;
                }
                
                const decoded = decodeURIComponent(atob(cardsParam));
                const imported = JSON.parse(decoded);
                
                let addedAnswers = 0;
                let addedQuestions = 0;
                
                if (imported.a && Array.isArray(imported.a)) {
                    imported.a.forEach(answer => {
                        if (!gameState.cardCollection.answers.some(c => 
                            c.text.toLowerCase() === answer.toLowerCase())) {
                            gameState.cardCollection.answers.push({
                                text: answer,
                                enabled: true,
                                isDefault: false
                            });
                            addedAnswers++;
                        }
                    });
                }
                
                if (imported.q && Array.isArray(imported.q)) {
                    imported.q.forEach(question => {
                        if (!gameState.cardCollection.questions.some(c => 
                            c.text.toLowerCase() === question.toLowerCase())) {
                            gameState.cardCollection.questions.push({
                                text: question,
                                enabled: true,
                                isDefault: false
                            });
                            addedQuestions++;
                        }
                    });
                }
                
                saveCardCollection();
                refreshCollection();
                document.getElementById('importUrl').value = '';
                
                if (addedAnswers === 0 && addedQuestions === 0) {
                    alert("You already have all these cards in your collection!");
                } else {
                    alert(`‚úÖ Imported ${addedAnswers} new answer cards and ${addedQuestions} new question cards!`);
                }
                
            } catch (error) {
                console.error("Import error:", error);
                alert("‚ùå Error importing cards. Make sure it's a valid share URL.");
            }
        }
        
        function exportCardsToFile() {
            const exportData = {
                version: '1.0',
                date: new Date().toISOString(),
                description: 'Cards Against Humanity Collection',
                answers: gameState.cardCollection.answers
                    .filter(card => !card.isDefault && card.enabled)
                    .map(card => card.text),
                questions: gameState.cardCollection.questions
                    .filter(card => !card.isDefault && card.enabled)
                    .map(card => card.text)
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `cards-collection-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            alert("‚úÖ Cards exported to file! You can share this file with friends.");
        }
        
        function importCardsFromFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    try {
                        const imported = JSON.parse(event.target.result);
                        
                        let addedAnswers = 0;
                        let addedQuestions = 0;
                        
                        if (imported.answers && Array.isArray(imported.answers)) {
                            imported.answers.forEach(answer => {
                                if (!gameState.cardCollection.answers.some(c => 
                                    c.text.toLowerCase() === answer.toLowerCase())) {
                                    gameState.cardCollection.answers.push({
                                        text: answer,
                                        enabled: true,
                                        isDefault: false
                                    });
                                    addedAnswers++;
                                }
                            });
                        }
                        
                        if (imported.questions && Array.isArray(imported.questions)) {
                            imported.questions.forEach(question => {
                                if (!gameState.cardCollection.questions.some(c => 
                                    c.text.toLowerCase() === question.toLowerCase())) {
                                    gameState.cardCollection.questions.push({
                                        text: question,
                                        enabled: true,
                                        isDefault: false
                                    });
                                    addedQuestions++;
                                }
                            });
                        }
                        
                        saveCardCollection();
                        refreshCollection();
                        
                        alert(`‚úÖ Imported ${addedAnswers} new answer cards and ${addedQuestions} new question cards!`);
                    } catch (error) {
                        alert('‚ùå Error importing cards. Make sure it\'s a valid cards file.');
                        console.error(error);
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        function loadCardsFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const cardsParam = urlParams.get('cards');
            
            if (cardsParam) {
                try {
                    const decoded = decodeURIComponent(atob(cardsParam));
                    const imported = JSON.parse(decoded);
                    
                    let addedAnswers = 0;
                    let addedQuestions = 0;
                    
                    if (imported.a && Array.isArray(imported.a)) {
                        imported.a.forEach(answer => {
                            if (!gameState.cardCollection.answers.some(c => 
                                c.text.toLowerCase() === answer.toLowerCase())) {
                                gameState.cardCollection.answers.push({
                                    text: answer,
                                    enabled: true,
                                    isDefault: false
                                });
                                addedAnswers++;
                            }
                        });
                    }
                    
                    if (imported.q && Array.isArray(imported.q)) {
                        imported.q.forEach(question => {
                            if (!gameState.cardCollection.questions.some(c => 
                                c.text.toLowerCase() === question.toLowerCase())) {
                                gameState.cardCollection.questions.push({
                                    text: question,
                                    enabled: true,
                                    isDefault: false
                                });
                                addedQuestions++;
                            }
                        });
                    }
                    
                    if (addedAnswers > 0 || addedQuestions > 0) {
                        saveCardCollection();
                        setTimeout(() => {
                            alert(`üì• Loaded ${addedAnswers} answer cards and ${addedQuestions} question cards from URL!`);
                        }, 1000);
                    }
                } catch (error) {
                    console.error('Failed to load cards from URL:', error);
                }
            }
        }
        
        // ==================== SCREEN MANAGEMENT ====================
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId + 'Screen').classList.add('active');
            
            if (screenId === 'collection') {
                refreshCollection();
            } else if (screenId === 'share') {
                updateMenuStats();
            }
        }
        
        function switchCollectionTab(tabId) {
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.querySelector(`[onclick="switchCollectionTab('${tabId}')"]`).classList.add('active');
            document.getElementById(tabId + 'Tab').classList.add('active');
        }
        
        function switchCreateTab(tabId) {
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.querySelector(`[onclick="switchCreateTab('${tabId}')"]`).classList.add('active');
            document.getElementById(tabId + 'CreateTab').classList.add('active');
        }
        
        function refreshCollection() {
            // Update answer collection
            const answerContainer = document.getElementById('answerCollection');
            answerContainer.innerHTML = '';
            
            let enabledAnswers = 0;
            gameState.cardCollection.answers.forEach((card, index) => {
                const cardDiv = document.createElement('div');
                cardDiv.className = `card ${card.enabled ? '' : 'disabled'}`;
                
                cardDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 14px;">${card.text}</span>
                        <div class="collection-controls">
                            ${card.isDefault ? 
                                '<span style="color: #666; font-size: 11px;">Default</span>' : 
                                ''
                            }
                            <button class="${card.enabled ? 'btn-disable' : 'btn-enable'}" 
                                    onclick="toggleCardEnabled('answers', ${index})">
                                ${card.enabled ? 'Disable' : 'Enable'}
                            </button>
                            ${!card.isDefault ? `
                                <button class="btn-delete" 
                                        onclick="deleteCard('answers', ${index})">
                                    Delete
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
                answerContainer.appendChild(cardDiv);
                
                if (card.enabled) enabledAnswers++;
            });
            
            document.getElementById('enabledAnswersCount').textContent = enabledAnswers;
            document.getElementById('totalAnswersCount').textContent = gameState.cardCollection.answers.length;
            
            // Update question collection
            const questionContainer = document.getElementById('questionCollection');
            questionContainer.innerHTML = '';
            
            let enabledQuestions = 0;
            gameState.cardCollection.questions.forEach((card, index) => {
                const cardDiv = document.createElement('div');
                cardDiv.className = `card ${card.enabled ? '' : 'disabled'}`;
                
                cardDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 14px;">${card.text}</span>
                        <div class="collection-controls">
                            ${card.isDefault ? 
                                '<span style="color: #666; font-size: 11px;">Default</span>' : 
                                ''
                            }
                            <button class="${card.enabled ? 'btn-disable' : 'btn-enable'}" 
                                    onclick="toggleCardEnabled('questions', ${index})">
                                ${card.enabled ? 'Disable' : 'Enable'}
                            </button>
                            ${!card.isDefault ? `
                                <button class="btn-delete" 
                                        onclick="deleteCard('questions', ${index})">
                                    Delete
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
                questionContainer.appendChild(cardDiv);
                
                if (card.enabled) enabledQuestions++;
            });
            
            document.getElementById('enabledQuestionsCount').textContent = enabledQuestions;
            document.getElementById('totalQuestionsCount').textContent = gameState.cardCollection.questions.length;
            
            updateMenuStats();
        }
        
        function toggleCardEnabled(type, index) {
            const collection = gameState.cardCollection[type];
            
            if (index >= 0 && index < collection.length) {
                collection[index].enabled = !collection[index].enabled;
                saveCardCollection();
                refreshCollection();
            }
        }
        
        function deleteCard(type, index) {
            const collection = gameState.cardCollection[type];
            
            if (index >= 0 && index < collection.length && !collection[index].isDefault) {
                if (confirm("Are you sure you want to delete this card?")) {
                    collection.splice(index, 1);
                    saveCardCollection();
                    refreshCollection();
                }
            }
        }
        
        function enableAllCards(type) {
            const collection = gameState.cardCollection[type];
            collection.forEach(card => {
                card.enabled = true;
            });
            saveCardCollection();
            refreshCollection();
        }
        
        function returnToMenu() {
            if (gameState.gameActive && gameState.gamePhase !== 'menu') {
                if (confirm("Are you sure you want to quit the game?")) {
                    stopTimer();
                    gameState.gameActive = false;
                    showScreen('menu');
                }
            } else {
                showScreen('menu');
            }
        }
        
        // ==================== INITIALIZE ====================
        console.log("üé¥ Cards Game Loaded!");
        initializeCardCollection();
        loadCardsFromURL();
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (gameState.gamePhase === "playing" && !gameState.isJudge && !gameState.playerHasSubmitted) {
                const key = e.key;
                const number = parseInt(key);
                
                if (number >= 1 && number <= 6) {
                    selectCard(number - 1);
                }
            }
        });
    </script>
</body>
</html>
